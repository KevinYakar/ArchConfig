#!/bin/bash

cd ~/ArchConfig

printArray () {
    arr=("$@")
    (( ${#arr[@]} == 0 )) && echo "none" && return
    for item in ${arr[@]};
    do
        echo $item
    done
}

# show differences from last commit
# differences=($(git diff b17b 6d4a | grep -E '^diff|\-\-\- \/dev\/null|\+\+\+ \/dev\/null' | sed -e "s/^diff.* b\//\.\//" -e "s/^\+.*/deleted/g" -e "s/^\-.*/added/g"))
differences=($(git diff $(git log | grep commit | head -n 2 | tail -n 1 | sed -e "s/commit //g") | grep -E '^diff|\-\-\- \/dev\/null|\+\+\+ \/dev\/null' | sed -e "s/^diff.* b\//\.\//" -e "s/^\+.*/deleted/g" -e "s/^\-.*/added/g"))

add=()
delete=()
modify=()

idx=0
while (( $idx < ${#differences[@]} ));
do
    current=${differences[$idx]}
    next=${differences[(( $idx + 1 ))]}

    case $next in
        added)
            add+=($current)
            ;;

        deleted)
            delete+=($current)
            ;;

        *)
            [ -z "$next" ] && [ $current != "added" ] && [ $current != "deleted" ] && modify+=($current)
            [ -n "$next" ] && [ $next != "added" ] && [ $next != "deleted" ] && [ $current != "added" ] && [ $current != "deleted" ] && modify+=($current)
            ;;
    esac
    idx=$(( idx + 1 ))
done

echo -e "Added:" | rainbow
printArray "${add[@]}"
echo

echo -e "Deleted:" | rainbow
printArray "${delete[@]}"
echo

echo -e "Modified:" | rainbow
printArray "${modify[@]}"
echo

# use these when creating directories

# printArray "${add[@]}" | awk -F '/' '{for(i=1;i<=NF-1;i++) printf $i"/"; print"'$add'"}' | uniq
# printArray "${delete[@]}" | awk -F '/' '{for(i=1;i<=NF-1;i++) printf $i"/"; print"'$delete'"}' | uniq
# printArray "${modify[@]}" | awk -F '/' '{for(i=1;i<=NF-1;i++) printf $i"/"; print"'$modify'"}' | uniq

# add shiz
# delete shiz
# only replace if it exists on local (for example, /home/kevin/update doesnt exist, so dont modify)

